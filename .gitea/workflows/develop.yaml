name: æ„å»ºä»£ç å¹¶å‘å¸ƒåˆ°è¿œç¨‹æœåŠ¡å™¨
run-name: ${{ gitea.actor }} is testing out Gitea Actions ğŸš€
on: [push]

jobs:
  Explore-Gitea-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ gitea.event_name }} event."
      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by Gitea!"
      - run: echo "ğŸ” The name of your branch is ${{ gitea.ref }} and your repository is ${{ gitea.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4

      - name: è®¾ç½®jdk
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'maven'
      - name: é¡¹ç›®æ‰“åŒ…
        run: mvn -B package

      - name: åˆ é™¤æ—§çš„jaråŒ…ä»¥åŠè¿è¡Œè„šæœ¬
        uses: garygrossgarten/github-action-ssh@release
        with:
          command: cd /root/mblog && ./run.sh stop && rm -rf target/**
          host: ${{ secrets.HOST }}
          username: root
          port: 22
          privateKey: ${{ secrets.PRIVATE_KEY}}
      - name: ä¸Šä¼ jaråŒ…å’Œå¯åŠ¨è„šæœ¬åˆ°æœåŠ¡å™¨ä¸­
        run: |
          echo "${{ secrets.PRIVATE_KEY }}" > ssh_key
          chmod 600 ssh_key
          scp -r -i ssh_key -P 22 -o StrictHostKeyChecking=no ./target/mblog-latest.jar root@${{secrets.HOST}}:/root/mblog/target/
          rm -rf ssh_key
        shell: bash
      - name: å¯åŠ¨é¡¹ç›®
        uses: garygrossgarten/github-action-ssh@release
        with:
          command: cd /root/mblog && ./run.sh start
          host: ${{ secrets.HOST }}
          username: root
          port: 53595
          privateKey: ${{ secrets.PRIVATE_KEY}}
